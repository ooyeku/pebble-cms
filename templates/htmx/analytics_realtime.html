{% if realtime %}
<div class="realtime-stats">
    <div class="realtime-stat">
        <span class="realtime-dot"></span>
        <div>
            <div class="realtime-value">{{ realtime.active_sessions }}</div>
            <div class="realtime-label">Active now</div>
        </div>
    </div>
    <div class="realtime-stat">
        <div>
            <div class="realtime-value">{{ realtime.pageviews_30min }}</div>
            <div class="realtime-label">Last 30 min</div>
        </div>
    </div>
    {% if realtime.current_pages | length > 0 %}
    <div class="realtime-pages">
        <div class="realtime-label">Currently viewing:</div>
        <div class="current-pages-list">
            {% for page in realtime.current_pages | slice(end=5) %}
            <span class="current-page"
                >{{ page.path | truncate(length=30) }} ({{ page.visitors
                }})</span
            >
            {% endfor %}
        </div>
    </div>
    {% endif %} {% if realtime.recent_referrers | length > 0 %}
    <div class="realtime-referrers">
        <div class="realtime-label">Recent traffic from:</div>
        <div class="recent-referrers-list">
            {% for ref in realtime.recent_referrers | slice(end=3) %}
            <span class="recent-referrer"
                >{{ ref.domain }}
                <small>({{ ref.seconds_ago }}s ago)</small></span
            >
            {% endfor %}
        </div>
    </div>
    {% endif %}
</div>
{% else %}
<div class="realtime-stats">
    <div class="realtime-stat">
        <span
            class="realtime-dot"
            style="background: var(--text-muted); animation: none"
        ></span>
        <div>
            <div class="realtime-value">0</div>
            <div class="realtime-label">Active now</div>
        </div>
    </div>
    <div class="realtime-stat">
        <div>
            <div class="realtime-value">0</div>
            <div class="realtime-label">Last 30 min</div>
        </div>
    </div>
</div>
{% endif %}

<style>
    .realtime-referrers {
        flex: 1;
        min-width: 150px;
    }
    .realtime-referrers .realtime-label {
        margin-bottom: 0.375rem;
    }
    .recent-referrers-list {
        display: flex;
        flex-wrap: wrap;
        gap: 0.5rem;
    }
    .recent-referrer {
        font-size: 0.75rem;
        padding: 0.25rem 0.625rem;
        background: var(--bg-secondary);
        border-radius: var(--radius);
        color: var(--text);
    }
    .recent-referrer small {
        color: var(--text-muted);
    }
</style>
